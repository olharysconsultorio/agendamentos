<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Olharys - Agendamento</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --primary: #00d2d3; --dark: #0c1c2c; --white: #ffffff; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Montserrat', sans-serif; color: var(--dark); }
        
        /* Header & Hero */
        header { position: fixed; width: 100%; padding: 20px 8%; background: rgba(12, 28, 44, 0.95); z-index: 1000; color: white; display: flex; justify-content: space-between; }
        .hero { height: 100vh; background: linear-gradient(rgba(12,28,44,0.8), rgba(12,28,44,0.4)), url('https://images.unsplash.com/photo-1579684385127-1ef15d508118?auto=format&fit=crop&w=1600'); background-size: cover; display: flex; align-items: center; padding: 0 8%; color: white; }
        .btn-main { padding: 16px 45px; background: var(--primary); border: none; border-radius: 50px; font-weight: 700; cursor: pointer; margin-top: 20px; }
        
        /* Se√ß√µes */
        section { padding: 80px 8%; }
        .section-title { text-align: center; margin-bottom: 40px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; }
        .card { padding: 30px; border: 1px solid #eee; border-radius: 15px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        
        /* Modal */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; justify-content: center; align-items: center; }
        .modal-box { background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 500px; position: relative; }
        
        /* Bot√µes de Sele√ß√£o */
        .prof-btn { display: flex; justify-content: space-between; padding: 20px; border: 2px solid #eee; border-radius: 10px; cursor: pointer; background: white; width: 100%; margin-bottom: 10px; text-align: left; }
        .prof-btn:hover { border-color: var(--primary); }
        
        /* Form */
        input, select { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 8px; }
        .btn-submit { width: 100%; padding: 15px; background: var(--dark); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <header>
        <div style="font-family: 'Playfair Display'; font-size: 1.5rem; color: var(--primary);">Olharys</div>
    </header>

    <section class="hero">
        <div>
            <h1 style="font-family: 'Playfair Display'; font-size: 3.5rem;">Cuide da sua vis√£o.</h1>
            <p>Agende com especialistas de forma r√°pida.</p>
            <button class="btn-main" onclick="abrirModal()">AGENDAR CONSULTA</button>
        </div>
    </section>

    <div class="modal-overlay" id="modalAgendamento">
        <div class="modal-box">
            <span style="position:absolute; top:15px; right:20px; font-size:28px; cursor:pointer;" onclick="fecharModal()">&times;</span>
            
            <div id="selectionScreen">
                <h2 style="text-align:center; margin-bottom:20px;">Escolha o Profissional</h2>
                
                <button class="prof-btn" onclick="escolherProfissional('optometrista', 'Guilherme (Optometrista)')">
                    <div><b>Optometrista</b><br><small>Exame de vista</small></div>
                    <div style="color:var(--primary); font-weight:bold;">R$ 120,00</div>
                </button>

                <button class="prof-btn" onclick="escolherProfissional('oftalmologista', 'Dr. Eduardo (Oftalmologista)')">
                    <div><b>Oftalmologista</b><br><small>Sa√∫de ocular</small></div>
                    <div style="color:var(--primary); font-weight:bold;">R$ 150,00</div>
                </button>
            </div>

            <div id="formScreen" style="display:none;">
                <button onclick="voltar()" style="background:none; border:none; cursor:pointer;">‚Üê Voltar</button>
                <h3 id="tituloForm" style="text-align:center; color:var(--primary); margin-bottom:15px;"></h3>
                
                <form id="formAgendamento">
                    <input type="text" id="nome" placeholder="Nome Completo" required>
                    <input type="tel" id="telefone" placeholder="Telefone" required>
                    <input type="text" id="cidade" placeholder="Cidade" required>
                    <label>Hor√°rios Dispon√≠veis:</label>
                    <select id="slotDisponivel" required><option>Carregando...</option></select>
                    <button type="submit" class="btn-submit" id="btnEnviar">CONFIRMAR</button>
                </form>
                <div id="mensagem" style="text-align:center; margin-top:10px; font-weight:bold;"></div>
            </div>
        </div>
    </div>

    <script>
        const URL = "https://script.google.com/macros/s/AKfycbw5u1fbH0wNTmg9VhnaEC59OAN0pFG8l3wNQM_MAhRo12AI2JGdUshKbL7hxx3sz-Yn/exec"; // <--- COLE AQUI
        const ZAP = "5544991837620";
        let profissionalAtual = ""; 
        let horariosCache = [];

        function abrirModal() {
            document.getElementById('modalAgendamento').style.display = 'flex';
            voltar();
            fetch(URL).then(r => r.json()).then(d => horariosCache = d); // Carrega agenda
        }
        function fecharModal() { document.getElementById('modalAgendamento').style.display = 'none'; }
        
        function escolherProfissional(tipo, nome) {
            profissionalAtual = tipo;
            document.getElementById('selectionScreen').style.display = 'none';
            document.getElementById('formScreen').style.display = 'block';
            document.getElementById('tituloForm').innerText = nome;
            
            const sel = document.getElementById("slotDisponivel");
            sel.innerHTML = '<option value="">Selecione...</option>';
            
            const filtrados = horariosCache.filter(h => h.tipo === tipo);
            if(filtrados.length === 0) sel.innerHTML = '<option>Sem hor√°rios</option>';
            else filtrados.forEach(i => {
                let opt = document.createElement("option");
                opt.value = i.id; opt.text = i.texto;
                sel.appendChild(opt);
            });
        }

        function voltar() {
            document.getElementById('formScreen').style.display = 'none';
            document.getElementById('selectionScreen').style.display = 'block';
        }

        document.getElementById('formAgendamento').addEventListener('submit', function(e) {
            e.preventDefault();
            const btn = document.getElementById('btnEnviar');
            btn.disabled = true; btn.innerText = "Agendando...";

            const dados = {
                action: "agendar",
                tipo: profissionalAtual,
                nome: document.getElementById('nome').value,
                telefone: document.getElementById('telefone').value,
                cidade: document.getElementById('cidade').value,
                slot_id: document.getElementById('slotDisponivel').value
            };

            fetch(URL, { method: 'POST', body: JSON.stringify(dados) })
            .then(r => r.json()).then(d => {
                if(d.result === 'success'){
                    document.getElementById('mensagem').innerText = "‚úÖ Sucesso! Abrindo WhatsApp...";
                    const texto = `*Novo Agendamento!* %0Aüë§ ${dados.nome} %0AüìÖ ${document.getElementById("slotDisponivel").selectedOptions[0].text}`;
                    setTimeout(() => {
                        window.open(`https://wa.me/${ZAP}?text=${texto}`, '_blank');
                        location.reload();
                    }, 1500);
                } else {
                    alert(d.message);
                    btn.disabled = false; btn.innerText = "TENTAR NOVAMENTE";
                }
            });
        });
    </script>
</body>
</html>
