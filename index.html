<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Olharys - Cl√≠nica de Olhos</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --primary: #00d2d3; --dark: #0c1c2c; --white: #ffffff; --light-bg: #f8f9fa; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Montserrat', sans-serif; color: var(--dark); line-height: 1.6; }
        
        /* HEADER & HERO */
        header { position: fixed; width: 100%; padding: 15px 8%; background: rgba(12, 28, 44, 0.98); z-index: 1000; color: white; display: flex; justify-content: space-between; align-items: center; }
        .hero { height: 100vh; background: linear-gradient(rgba(12,28,44,0.85), rgba(12,28,44,0.5)), url('https://images.unsplash.com/photo-1579684385127-1ef15d508118?auto=format&fit=crop&w=1600&q=80'); background-size: cover; display: flex; align-items: center; padding: 0 8%; color: white; }
        .btn-main { padding: 16px 45px; background: var(--primary); border: none; border-radius: 50px; font-weight: 700; cursor: pointer; margin-top: 20px; font-size: 1rem; color: var(--dark); transition: 0.3s; }
        .btn-main:hover { transform: translateY(-3px); }

        /* SE√á√ïES */
        section { padding: 80px 8%; }
        .section-title { text-align: center; margin-bottom: 50px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; }
        .service-card, .team-card, .review-card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); text-align: center; }
        
        /* FOOTER */
        footer { background: var(--dark); color: white; padding: 60px 8%; text-align: center; }
        .btn-social { display: inline-flex; align-items: center; gap: 10px; padding: 10px 20px; border-radius: 50px; color: white; text-decoration: none; font-weight: bold; margin: 5px; }
        .bg-whatsapp { background: #25D366; } .bg-email { background: #EA4335; } .bg-instagram { background: #C13584; }

        /* MODAL */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; justify-content: center; align-items: center; }
        .modal-box { background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 500px; position: relative; max-height: 90vh; overflow-y: auto; }
        .close-modal { position: absolute; top: 15px; right: 20px; font-size: 28px; cursor: pointer; color: #888; }
        
        .step-container { display: none; animation: fadeIn 0.3s ease; }
        .step-active { display: block; }
        
        .prof-btn { display: flex; justify-content: space-between; align-items: center; padding: 20px; border: 2px solid #eee; border-radius: 12px; cursor: pointer; background: white; width: 100%; margin-bottom: 15px; transition: 0.3s; }
        .prof-btn:hover { border-color: var(--primary); transform: translateY(-3px); }
        
        input, select { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 8px; font-size: 1rem; }
        .btn-submit { width: 100%; padding: 15px; background: var(--dark); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        
        /* BOT√ÉO DE AJUDA NO MODAL */
        .help-box { margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee; text-align: center; }
        .btn-help { background: #25D366; color: white; padding: 10px 20px; border-radius: 5px; text-decoration: none; font-size: 0.9rem; display: inline-block; font-weight: 600; margin-top: 5px;}

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <header>
        <div style="font-family: 'Playfair Display'; font-size: 1.5rem; color: var(--primary);">Olharys</div>
        <nav><a href="#contato" style="color:white; text-decoration:none;">Fale Conosco</a></nav>
    </header>

    <section class="hero">
        <div>
            <h1 style="font-family: 'Playfair Display'; font-size: 3.5rem;">Cuide da sua vis√£o.</h1>
            <p>Atendimento em 8 cidades com especialistas.</p>
            <button class="btn-main" onclick="abrirModal()">AGENDAR NA MINHA CIDADE</button>
        </div>
    </section>

    <section>
        <div class="section-title"><h2>Servi√ßos</h2></div>
        <div class="grid">
            <div class="service-card">
                <h3>Optometria</h3><p>Exame de vista preciso.</p>
                <strong style="color:var(--primary)">A partir de R$ 120,00</strong>
            </div>
            <div class="service-card">
                <h3>Oftalmologia</h3><p>Consulta m√©dica completa.</p>
                <strong style="color:var(--primary)">A partir de R$ 150,00</strong>
            </div>
        </div>
    </section>

    <footer id="contato">
        <h3>Fale Conosco</h3>
        <div class="contact-buttons">
            <a href="https://wa.me/5544991837620" class="btn-social bg-whatsapp"><i class="fab fa-whatsapp"></i> WhatsApp</a>
            <a href="consultorioolharys@gmail.com" class="btn-social bg-email"><i class="fas fa-envelope"></i> E-mail</a>
        </div>
    </footer>

    <div class="modal-overlay" id="modalAgendamento">
        <div class="modal-box">
            <span class="close-modal" onclick="fecharModal()">&times;</span>
            
            <div id="step1" class="step-container step-active">
                <h2 style="text-align:center;">Onde voc√™ est√°?</h2>
                <input list="cidadesList" id="cidadeInput" placeholder="Digite sua cidade (Ex: Curitiba)">
                <datalist id="cidadesList">
                    <option value="Umuarama"><option value="Perobal"><option value="Douradina">
                    <option value="Palotina"><option value="Marechal C. Rondon"><option value="Toledo">
                    <option value="Altonia"><option value="Cascavel">
                </datalist>
                <button class="btn-submit" onclick="irParaPasso2()">CONTINUAR</button>
                
                <div class="help-box">
                    <small>N√£o encontrou sua cidade?</small><br>
                    <a href="https://wa.me/5544991837620?text=Ol√°, n√£o encontrei minha cidade no site." target="_blank" class="btn-help"><i class="fab fa-whatsapp"></i> Falar com Atendente</a>
                </div>
            </div>

            <div id="step2" class="step-container">
                <button onclick="mudarPasso('step1')" style="border:none; background:none; cursor:pointer;">‚Üê Voltar</button>
                <h2 style="text-align:center; margin-bottom:20px;">Qual atendimento?</h2>
                <div class="prof-btn" onclick="irParaPasso3('Optometrista')">
                    <div><b>Optometrista</b><br><small>Exame de vista</small></div>
                    <div style="color:var(--primary); font-weight:bold;">R$ 120,00</div>
                </div>
                <div class="prof-btn" onclick="irParaPasso3('Oftalmologista')">
                    <div><b>Oftalmologista</b><br><small>Consulta M√©dica</small></div>
                    <div style="color:var(--primary); font-weight:bold;">R$ 150,00</div>
                </div>
            </div>

            <div id="step3" class="step-container">
                <button onclick="mudarPasso('step2')" style="border:none; background:none; cursor:pointer;">‚Üê Voltar</button>
                <h3 id="tituloForm" style="text-align:center; color:var(--primary); margin-bottom:20px;"></h3>
                
                <form id="formAgendamento">
                    <input type="text" id="nome" placeholder="Nome Completo" required>
                    <input type="tel" id="telefone" placeholder="Telefone / WhatsApp" required>
                    <label>Hor√°rios Dispon√≠veis:</label>
                    <select id="slotDisponivel" required><option>Carregando...</option></select>
                    <button type="submit" class="btn-submit" id="btnEnviar">CONFIRMAR AGENDAMENTO</button>
                </form>
                
                <div class="help-box">
                    <small>Sem hor√°rios dispon√≠veis?</small><br>
                    <a href="https://wa.me/5541996509734?text=Ol√°, n√£o achei hor√°rio dispon√≠vel." target="_blank" class="btn-help"><i class="fab fa-whatsapp"></i> Encaixe via WhatsApp</a>
                </div>
                
                <div id="mensagem" style="text-align:center; margin-top:15px; font-weight:bold;"></div>
            </div>
        </div>
    </div>

    <script>
        // --- COLE SUA URL AQUI ---
        const URL = "https://script.google.com/macros/s/AKfycbxQLUvSYIwuy2i56G3XB8KBoXPJCn_Pmge9brgnbK4GxIGrDCBKZXc-d95leLv23lV4/exec"; 
        
        const ZAP = "5544991837620";
        let cidadeEscolhida = "";
        let horariosCache = [];

        function abrirModal() {
            document.getElementById('modalAgendamento').style.display = 'flex';
            mudarPasso('step1');
            fetch(URL).then(r => r.json()).then(d => horariosCache = d);
        }
        function fecharModal() { document.getElementById('modalAgendamento').style.display = 'none'; }
        
        function mudarPasso(stepId) {
            document.querySelectorAll('.step-container').forEach(el => el.classList.remove('step-active'));
            document.getElementById(stepId).classList.add('step-active');
        }

        function irParaPasso2() {
            cidadeEscolhida = document.getElementById('cidadeInput').value;
            if(!cidadeEscolhida) { alert("Digite sua cidade!"); return; }
            mudarPasso('step2');
        }

        function irParaPasso3(tipo) {
            mudarPasso('step3');
            document.getElementById('tituloForm').innerText = `${tipo} em ${cidadeEscolhida}`;
            const sel = document.getElementById("slotDisponivel");
            sel.innerHTML = '<option value="">Selecione um hor√°rio...</option>';
            
            // FILTRO: Cidade + Tipo (Ignora case sensitive)
            const filtrados = horariosCache.filter(h => 
                h.cidade.trim().toLowerCase() === cidadeEscolhida.trim().toLowerCase() && 
                h.profissional.includes(tipo)
            );

            if(filtrados.length === 0) sel.innerHTML = '<option>Nenhum hor√°rio dispon√≠vel</option>';
            else filtrados.forEach(i => {
                let opt = document.createElement("option");
                opt.value = i.id; 
                // Ex: "Guilherme - 25/01 √†s 14:00"
                opt.text = `${i.profissional.split(' - ')[0]} - ${i.texto}`; 
                sel.appendChild(opt);
            });
        }

        document.getElementById('formAgendamento').addEventListener('submit', function(e) {
            e.preventDefault();
            const btn = document.getElementById('btnEnviar');
            btn.disabled = true; btn.innerText = "Agendando...";

            const slotId = document.getElementById('slotDisponivel').value;
            const nome = document.getElementById('nome').value;

            fetch(URL, { 
                method: 'POST', 
                body: JSON.stringify({
                    action: "agendar",
                    nome: nome,
                    telefone: document.getElementById('telefone').value,
                    cidade: cidadeEscolhida,
                    slot_id: slotId,
                    profissional_nome: document.getElementById("slotDisponivel").selectedOptions[0].text,
                    horario_texto: document.getElementById("slotDisponivel").selectedOptions[0].text
                })
            })
            .then(r => r.json()).then(d => {
                if(d.result === 'success'){
                    document.getElementById('mensagem').innerText = "‚úÖ Sucesso! Abrindo WhatsApp...";
                    document.getElementById('mensagem').style.color = "green";
                    const info = document.getElementById("slotDisponivel").selectedOptions[0].text;
                    
                    setTimeout(() => {
                        window.open(`https://wa.me/${ZAP}?text=*Agendamento Confirmado!* %0Aüë§ ${nome} %0Aüìç ${cidadeEscolhida} %0AüìÖ ${info}`, '_blank');
                        location.reload();
                    }, 1500);
                } else {
                    alert(d.message);
                    btn.disabled = false; btn.innerText = "TENTAR NOVAMENTE";
                }
            });
        });
    </script>
</body>
</html>
